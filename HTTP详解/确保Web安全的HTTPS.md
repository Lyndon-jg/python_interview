### HTTP的缺点

#### HTTP的主要缺点

* 通信使用明文，内容可能会被窃听。
* 不验证通信方的身份，因此可能遭遇伪装。
* 无法证明报文的完整性，所以可能已经被篡改。

#### 通信使用明文可能会被窃听

* HTTP本身不具备加密的功能。所以也无法做到对通信整体进行加密。即：HTTP报文使用明文发送。
* TCP/IP是可能被窃听的网络。
* 加密处理防止被窃听。
  * 通信的加密。
  * 内容的加密。

#### 不验证通信方的身份就可能遭遇伪装

* 任何人都可以发起请求。
  * 无法确定请求发送至目标的web服务器是否是按照真实意图返回响应的那台服务器。有可能是已伪装的服务器。
  * 无法确定响应返回的客户端是否是按真实意图接收响应的那个客户端。有可能是已伪装的客户端。
  * 无法确定正在通信的对方是否具备访问权限，因为某些web服务器上保存着重要信息，只想发送给特定用户通信的权限。
  * 无法判定请求是来自何方，出自谁手。
  * 即使是无意义的请求也会照单全收。无法阻止海量请求下的DoS攻击。
* 查明对手的证书

#### 无法证明报文完整性，可能已遭篡改

* 接收到的内容可能有误。
  * HTTP协议无法证明通信的报文的完整性，因此，在请求或响应发出之后知道对方接收之前的这一段时间内，即使请求或者响应的内容被篡改，也没有办法知道。
  * 中间人攻击。
* 如何防止篡改？
  * 使用md5和SHA-1等散列值校验的方法，以及用来确认文件的数字签名方法。
  * 仅靠HTTP确保完整性是非常困难的。



### HTTP+加密+认证+完整性保护=HTTPS

#### HTTP加上加密处理和认证以及完整性保护之后即是HTTPS

* 对于HTTP来说，客户端和服务端都是没有办法确认通信方的。
* 添加了加密及认证机制的HTTP称为HTTPS。

#### HTTPS是身披SSL外壳的HTTP

* HTTPS并不是应用层的一种新协议。只是HTTP通信接口部分使用SSL和TSL协议代替而已。
* 通常情况下，HTTP直接和TCP通信，使用了SSL之后，HTTP先和SSL通信，再由SSL和TCP通信。
* 在采用SSL之后，HTTP就有了HTTPS的加密、证书和完整保护这些功能。
* SSL是独立于HTTP的协议，所以除HTTP之外其它的SMTP和Telnet等协议均可以使用。SSL是当今世界上使用最广泛的安全技术。

#### 相互交换密钥的公开密钥加密技术

SSL采用一种公开密钥加密的加密处理方式。

* 共享密钥加密的窘境

  * 加密和解密用同一个密钥的方式称为共享密钥加密，也叫做对称密钥加密。

    > 以共享密钥方式加密时必须将密钥也发给对方。但是发送密钥就有被窃听的风险，但是不发送，对方就不能解密。再说，如果密钥能够安全送达，那么数据也应该能够安全送达。

* 使用两把密钥的公开密钥加密

  > 公开密钥加密方式很好的解决了共享密钥加密的困难。

  * 公开密钥加密使用一对非对称的密钥，一把叫私有密钥，一把是公开密钥。

    > 使用公开密钥加密，发送密文的一方使用公开密钥加密，对方收到加密的信息之后，使用私钥进行解密，利用这种方式，不需要发送用来解密的的私有密钥。

* HTTPS采用混合加密机制

  > HTTPS采用共享密钥加密和公开密钥加密两者并用的混合加密机制。若密钥能够安全交换，那么有可能会考虑仅用公开密钥加密的方式来加密，但是公开密钥加密的方式与共享密钥加密相比，处理速度要慢。
  >
  > 所以使用混合加密，发挥各种加密的优势，在交换密钥的环节使用公开密钥加密。之后建立通信交换报文阶段则使用共享密钥加密方式。

* 证明公开密钥正确性的证书

* HTTPS的安全通信机制

  * 客户端通过发送Client Hello报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件列表（所使用的加密算法及密钥长度）
  * 服务器可进行SSL通信时，会以Server Hello报文作为应答。和客户端一样，在报文中包含SSL版本及加密组件。服务器的加密组件是从接收到的客户端加密组件那筛选出来的。
  * 之后服务器发送Certificate报文，报文中包含公开密钥证书。
  * 最后服务器发送Server Hello Done报文通知客户端，最初阶段的SSL握手协商结束。
  * SSL第一次握手结束之后，客户端以Client Key Exchange报文作为回应。报文中包含通信加密中使用的一种被称为Pre-master secert的随机密码串，该报文已用3步骤中的公开密钥进行加密。
  * 接着客户端继续发送Change Cipher Spec报文，该报文会提示服务器，在此报文之后的通信会采用Pre-master secert密钥加密。
  * 客户端发送Finished报文。该报文包含连接至今全部报文的整体校验值。这次协商是否能够成功，要以服务器是否能正确解密该报文作为判定标准。
  * 服务器同样发送Change Cipher Spec报文。
  * 服务器同样发送Finished报文。
  * 客户端和服务器的Finished报文交换完毕之后，SSL连接就算建立完成。当然，通信会受到SSL的保护。从此处开始进行应用层协议的通信，即发送HTTP请求。
  * 应用层协议通信。即发送HTTP响应。
  * 最后由客户端断开连接。断开连接时，发送close_notify报文。之后再发送TCP FIN报文来关闭和TCP的通信。
  * 在以上流程中，应用层发送数据会附加一种叫做MAC(Message Authentication code)的报文摘要。MAC能查知报文是否遭到篡改，从而保证报文的完整性。

* SSL速度慢吗？HTTPS也存在一些问题，那就是当使用SSL时，它的处理速度会变慢。

  * SSL的慢分两种：通信慢、由于大量消耗CPU及内存等资源，导致处理速度变慢。
  * 除去和TCP连接、发送HTTP请求/响应之外，还必须进行SSL通信。因此整体请求上的通信量增加了。
  * SSL必须要进行加密处理。在服务器端和客户端都需要进行加密和解密的运算处理。因此从结果上讲：比起HTTP会更多的消耗服务器和客户端的硬件资源，导致负载增强。

* 为什么不一直使用HTTPS？

  > 与纯文本通信相比，加密通信会消耗更多的CPU及内存资源。如果每次通信都加密，会消耗相当多的资源。平摊到一台计算机上时，能够处理的请求数量也会随之减少。
  >
  > 因此，如果是非敏感信息则用HTTP通信，只有存在保安个人信息的敏感数据时，才利用HTTPS加密通信。
  >
  > 特别是每当那些访问量较多的Web网站在进行加密处理时，他们承担着的负载不容小觑，在进行加密处理时，并非对所有内容都进行加密处理，而是仅在需要信息隐藏时才会进行加密。以节约资源。

  